<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD Empleados</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <style>
        body {
            background-color: rgba(244, 236, 225, 0.24);
        }
        table {
            background-color: white;
        }
        
        .search-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        .search-container input {
            padding-left: 30px;
        }
        .search-container .fa-search {
            position: relative;
            left: 25px;
            top: 8px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <h1 class="text-center mt-4">Empleados</h1>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="table-responsive">
                    <div class="text-center mb-3">
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
                            Añadir Empleado
                        </button>
                    </div>
                    <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addEmployeeModalLabel">Añadir Nuevo Empleado</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="employeeForm">
                                        <input type="hidden" id="employeeId" value="">
                                        <div class="form-group">
                                            <label>Nombre</label>
                                            <input type="text" class="form-control" id="employeeNombre" placeholder="Ingrese nombre del empleado" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Apellido</label>
                                            <input type="text" class="form-control" id="employeeApellido" placeholder="Ingrese apellido" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Teléfono</label>
                                            <input type="number" class="form-control" id="employeeTelefono" placeholder="Ingrese Teléfono" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Correo electrónico</label>
                                            <input type="email" class="form-control" id="employeeEmail" placeholder="Ingrese correo" required>
                                        </div>
                                        <div class="form-group">
                                            <label>DNI</label>
                                            <input type="number" class="form-control" id="employeeDNI" placeholder="Ingrese DNI" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Dirección</label>
                                            <input type="text" class="form-control" id="employeeDireccion" placeholder="Ingrese Dirección" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Localidad</label>
                                            <input type="text" class="form-control" id="employeeLocalidad" placeholder="Ingrese Localidad" required>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button type="button" id="submitEmployee" class="btn btn-success">Guardar</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" class="form-control" placeholder="Buscar empleado...">
                    </div>
                    <table id="empleadosTable" class="table table-bordered table-hover table-striped mt-4">
                        <thead>
                            <tr>
                                <th scope="col">ID Empleado</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">Apellido</th>
                                <th scope="col">Teléfono</th>
                                <th scope="col">Correo Electrónico</th>
                                <th scope="col">DNI</th>
                                <th scope="col">Dirección</th>
                                <th scope="col">Localidad</th>
                                <th>Editar</th>
                                <th>Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Aquí se agregarán los empleados -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        let employeeIdCounter = 1; // Contador para ID de empleados
        let editingEmployee = false;

        // Cargar empleados desde localStorage al cargar la página
        window.onload = function() {
            const storedEmployees = JSON.parse(localStorage.getItem('employees'));
            if (storedEmployees) {
                storedEmployees.forEach(employee => {
                    addEmployeeRow(employee);
                    employeeIdCounter = Math.max(employeeIdCounter, employee.id + 1); // Actualiza el contador
                });
            }
        };

        document.getElementById('submitEmployee').addEventListener('click', function() {
            const nombre = document.getElementById('employeeNombre').value;
            const apellido = document.getElementById('employeeApellido').value;
            const telefono = document.getElementById('employeeTelefono').value;
            const email = document.getElementById('employeeEmail').value;
            const dni = document.getElementById('employeeDNI').value;
            const direccion = document.getElementById('employeeDireccion').value;
            const localidad = document.getElementById('employeeLocalidad').value;
            const id = document.getElementById('employeeId').value;

            const employee = {
                id: editingEmployee ? parseInt(id) : employeeIdCounter,
                nombre,
                apellido,
                telefono,
                email,
                dni,
                direccion,
                localidad
            };

            if (editingEmployee) {
                updateEmployeeRow(employee);
                editingEmployee = false;
            } else {
                addEmployeeRow(employee);
                employeeIdCounter++;
            }

            saveEmployeesToLocalStorage();

            const modal = bootstrap.Modal.getInstance(document.getElementById('addEmployeeModal'));
            modal.hide();
            document.getElementById('employeeForm').reset();
        });

        function addEmployeeRow(employee) {
            const newRow = `
                <tr data-id="${employee.id}">
                    <td>${employee.id}</td>
                    <td>${employee.nombre}</td>
                    <td>${employee.apellido}</td>
                    <td>${employee.telefono}</td>
                    <td>${employee.email}</td>
                    <td>${employee.dni}</td>
                    <td>${employee.direccion}</td>
                    <td>${employee.localidad}</td>
                    <td><button class="btn btn-warning" onclick="editEmployee(${employee.id})">EDITAR</button></td>
                    <td><button class="btn btn-danger" onclick="deleteEmployee(${employee.id})">ELIMINAR</button></td>
                </tr>
            `;
            document.querySelector('#empleadosTable tbody').insertAdjacentHTML('beforeend', newRow);
        }

        function updateEmployeeRow(employee) {
            const row = document.querySelector(`tr[data-id='${employee.id}']`);
            row.children[1].innerText = employee.nombre;
            row.children[2].innerText = employee.apellido;
            row.children[3].innerText = employee.telefono;
            row.children[4].innerText = employee.email;
            row.children[5].innerText = employee.dni;
            row.children[6].innerText = employee.direccion;
            row.children[7].innerText = employee.localidad;
        }

        function saveEmployeesToLocalStorage() {
            const rows = document.querySelectorAll('#empleadosTable tbody tr');
            const employees = Array.from(rows).map(row => {
                return {
                    id: parseInt(row.dataset.id),
                    nombre: row.children[1].innerText,
                    apellido: row.children[2].innerText,
                    telefono: row.children[3].innerText,
                    email: row.children[4].innerText,
                    dni: row.children[5].innerText,
                    direccion: row.children[6].innerText,
                    localidad: row.children[7].innerText
                };
            });
            localStorage.setItem('employees', JSON.stringify(employees));
        }

        function editEmployee(id) {
            const row = document.querySelector(`tr[data-id='${id}']`);
            const cells = row.querySelectorAll('td');

            document.getElementById('employeeNombre').value = cells[1].innerText;
            document.getElementById('employeeApellido').value = cells[2].innerText;
            document.getElementById('employeeTelefono').value = cells[3].innerText;
            document.getElementById('employeeEmail').value = cells[4].innerText;
            document.getElementById('employeeDNI').value = cells[5].innerText;
            document.getElementById('employeeDireccion').value = cells[6].innerText;
            document.getElementById('employeeLocalidad').value = cells[7].innerText;

            document.getElementById('employeeId').value = id;
            editingEmployee = true;

            const modal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
            modal.show();
        }

        function deleteEmployee(id) {
            const row = document.querySelector(`tr[data-id='${id}']`);
            row.remove();
            saveEmployeesToLocalStorage(); // Guardar después de eliminar
        }

        document.getElementById('searchInput').addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('#empleadosTable tbody tr');

            rows.forEach(row => {
                const cells = row.getElementsByTagName('td');
                let match = false;

                for (let i = 1; i < cells.length - 2; i++) { // Recorre las celdas (ignora ID, Editar y Eliminar)
                    if (cells[i].innerText.toLowerCase().includes(filter)) {
                        match = true;
                        break;
                    }
                }

                row.style.display = match ? '' : 'none';
            });
        });
    </script>
</body>
</html>



